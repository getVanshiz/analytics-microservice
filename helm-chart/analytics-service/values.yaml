image:
  repository: analytics-service
  tag: "v22"
  pullPolicy: Never

replicaCount: 1

service:
  port: 8080
  name: http

env:
  # ðŸ‘‡ Add this first so it overrides the Dockerfile's PYTHONPATH
  - name: PYTHONPATH
    value: "/"

  - name: KAFKA_BOOTSTRAP
    value: "team4-kafka-kafka-bootstrap.team4.svc:9092"

  - name: ENABLE_ANALYTICS_TOPIC
    value: "true"

  - name: INPUT_TOPICS
    value: "user-events,order-events,notification-events"

  - name: ANALYTICS_TOPIC
    value: "analytics-events"

  - name: CONSUMER_GROUP
    value: "observability-group-v2"

  # InfluxDB configuration for derived event metrics
  - name: INFLUX_URL
    value: "http://influxdb2.team4.svc:80"
  - name: INFLUX_ORG
    value: "team4"
  - name: INFLUX_BUCKET
    value: "analytics"
  - name: INFLUX_TOKEN
    valueFrom:
      secretKeyRef:
        name: influxdb2-auth
        key: admin-token

# (Your template does not render .Values.extraEnv; it's safe to keep or remove)
extraEnv:
  - name: OTEL_SERVICE_NAME
    value: "analytics-service"
  - name: OTEL_EXPORTER_OTLP_TRACES_ENDPOINT
    value: "http://otel-collector-opentelemetry-collector.monitoring.svc.cluster.local:4317"
  - name: OTEL_EXPORTER_OTLP_PROTOCOL
    value: "grpc"
  - name: OTEL_TRACES_SAMPLER
    value: "parentbased_always_on"
  - name: OTEL_COLLECTOR_METRICS_ENDPOINT
    value: "http://otel-collector-opentelemetry-collector.monitoring.svc.cluster.local:8888"

podAnnotations:
  prometheus.io/scrape: "true"
  prometheus.io/path: "/metrics"
  prometheus.io/port: "8080"

resources: {}

serviceMonitor:
  enabled: true
  interval: 30s
  scrapePath: /metrics
  labels:
    release: kube-prometheus-stack

labels: {}

tracing:
  enabled: true
  serviceName: analytics-service
  endpoint: http://otel-collector-opentelemetry-collector.monitoring.svc.cluster.local:4317
  protocol: grpc
  sampler: parentbased_always_on
  resourceAttributes: {}

probes:
  liveness:
    path: /health
    initialDelaySeconds: 10   # bump a bit during bring-up
    periodSeconds: 10
  readiness:
    path: /health
    initialDelaySeconds: 10   # bump a bit during bring-up
    periodSeconds: 5